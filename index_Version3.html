<!-- âœ… Play Button Script -->
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const statusText = document.getElementById('statusText');
    const moveList = document.getElementById('moveList');
    const playBtn = document.getElementById('playBtn');
    const playAI = document.getElementById('playAI');
    const aiSide = document.getElementById('aiSide');
    const aiStrength = document.getElementById('aiStrength');
    const orientationSelect = document.getElementById('orientation');
    const showLegal = document.getElementById('showLegal');

    let game = new Chess();
    let board = Chessboard('board', {
      draggable: true,
      position: 'start',
      orientation: orientationSelect.value,
      onDrop: handleMove
    });

    function handleMove(source, target) {
      const move = game.move({ from: source, to: target, promotion: 'q' });
      if (!move) return 'snapback';

      updateBoard();
      logMove(move.san);

      if (playAI.checked && game.turn() === aiSide.value[0]) {
        setTimeout(() => {
          const aiMove = getBestMove(game, parseInt(aiStrength.value));
          if (aiMove) {
            game.move(aiMove);
            updateBoard();
            logMove(aiMove.san);
          }
        }, 300);
      }
    }

    function updateBoard() {
      board.position(game.fen());
      statusText.textContent = game.in_checkmate()
        ? 'Checkmate!'
        : game.in_draw()
        ? 'Draw!'
        : game.in_check()
        ? 'Check!'
        : 'Your move';
    }

    function logMove(san) {
      const item = document.createElement('li');
      item.textContent = san;
      moveList.appendChild(item);
    }

    playBtn.addEventListener('click', () => {
      game.reset();
      board.orientation(orientationSelect.value);
      board.position(game.fen());
      moveList.innerHTML = '';
      statusText.textContent = 'Game started!';
    });

    orientationSelect.addEventListener('change', () => {
      board.orientation(orientationSelect.value);
    });

    // Basic minimax AI (depth-limited)
    function getBestMove(game, strength) {
      const depth = Math.max(1, Math.floor((strength - 600) / 500));
      return minimaxRoot(depth, game, true);
    }

    function minimaxRoot(depth, game, isMaximizingPlayer) {
      const moves = game.moves({ verbose: true });
      let bestMove = null;
      let bestValue = -Infinity;

      for (const move of moves) {
        game.move(move);
        const value = minimax(depth - 1, game, !isMaximizingPlayer);
        game.undo();
        if (value > bestValue) {
          bestValue = value;
          bestMove = move;
        }
      }
      return bestMove;
    }

    function minimax(depth, game, isMaximizingPlayer) {
      if (depth === 0) return evaluateBoard(game.board());

      const moves = game.moves({ verbose: true });
      let bestValue = isMaximizingPlayer ? -Infinity : Infinity;

      for (const move of moves) {
        game.move(move);
        const value = minimax(depth - 1, game, !isMaximizingPlayer);
        game.undo();
        bestValue = isMaximizingPlayer
          ? Math.max(bestValue, value)
          : Math.min(bestValue, value);
      }
      return bestValue;
    }

    function evaluateBoard(board) {
      const values = { p: 1, n: 3, b: 3, r: 5, q: 9, k: 0 };
      let score = 0;
      for (const row of board) {
        for (const piece of row) {
          if (piece) {
            const value = values[piece.type];
            score += piece.color === 'w' ? value : -value;
          }
        }
      }
      return score;
    }
  });
</script>
